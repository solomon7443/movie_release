<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>영화 개봉 일정</title>
		<style>
			a:link, a:visited {
				color: black;
				text-decoration: underline;
				cursor: pointer;
			}

			a:link:hover, a:visited:hover {
				text-decoration: underline;
			}
			tr:hover {
				background-color: #f5f5f5;
			}
			td#logo, td#director, td#cast{
				text-align:right;
			}
			div.search-table-outter { overflow-x: auto; }
			#poster{
				position:absolute;
				padding:5px;
				z-index: 9999;
				background-color:transparent;
			}
		</style>
	</head>
	<body>
		<div class = "search-table-outter">
			<table class="movie_table">
				<thead>
					<tr>
						<th></th>
						<th>제목</th>
						<th>날짜</th>
						<th>감독</th>
						<th>주연</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<script>
			function loadFile(filePath) {
				var result = null;
				var xmlhttp = new XMLHttpRequest();
				xmlhttp.open("GET", filePath, false);
				xmlhttp.send();
				if (xmlhttp.status==200) {
				result = xmlhttp.responseText;
				}
				return result;
			}
			
			var table = document.querySelector("table.movie_table");
			var tbody = table.children[1];
			var body = document.querySelector("body");
			
			var Res = loadFile('./movie.json'+ '?' + (new Date()).getTime());;
			Res = JSON.parse(Res);
			Res["movies"].forEach(function(movie){
				var tr = document.createElement("tr");
				
				var td = document.createElement("td");
				td.id = 'logo';
				movie["distribution"].forEach(function(distrib){
					var img = document.createElement("img");
					img.src = "./logo/"+distrib["logo"];
					img.title = distrib["company"];
					td.appendChild(img);
				});
				tr.appendChild(td);
				
				var td = document.createElement("td");
				td.id = 'title';
				if(movie["trailer"].length > 0){
					var a = document.createElement("a");
					a.href = movie["trailer"]
					a.innerText = movie["title"];
					td.appendChild(a);
				}else{
					var div = document.createElement("div");
					div.innerText = movie["title"];
					td.appendChild(div);
				}
				AddPoster(td,movie["poster"]);
				tr.appendChild(td);
				
				var td = document.createElement("td");
				td.id = 'release_date';
				td.innerText = movie["release"];
				tr.appendChild(td);
				
				var td = document.createElement("td");
				td.id = 'director';
				td.innerText = movie["director"].join(', ')
				tr.appendChild(td);
				
				var td = document.createElement("td");
				td.id = 'cast';
				td.innerText = movie["cast"].join(', ')
				tr.appendChild(td);
				
				tbody.appendChild(tr);
			});
			
			function AddPoster(element,Posterurl){
				element.addEventListener('mouseenter',function(event){
					var poster = document.createElement("img");
					poster.id = "poster";
					poster.src = './poster/'+Posterurl;
					body.appendChild(poster);
				});
				element.addEventListener('mousemove',function(event){
					var mousex = event.clientX + 24 + 'px';
					var mousey = event.clientY + 16 + 'px';
					var poster = document.querySelector("img#poster");
					poster.style.top = mousey;
					poster.style.left = mousex;
				});
				element.addEventListener('mouseleave',function(event){
					var poster = document.querySelector("img#poster");
					poster.parentNode.removeChild(poster);
				});
			}
		</script>
	</body>
</html>
